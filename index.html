<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flame Assistant Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Dark theme background (Midnight Blue) */
            color: #e5e7eb; /* Light gray text */
        }
        /* Custom scrollbar for chat history */
        #chat-history::-webkit-scrollbar {
            width: 6px;
        }
        #chat-history::-webkit-scrollbar-thumb {
            background-color: #ff8a00; /* Flame Orange */
            border-radius: 3px;
        }
        #chat-history::-webkit-scrollbar-track {
            background-color: #313154;
        }
        .status-dot {
            transition: background-color 0.3s ease;
        }
        /* Style for the copy button when clicked */
        .copied {
            background-color: #10b981 !important; /* Green for success */
        }
    </style>
</head>
<body class="min-h-screen p-3 sm:p-6 lg:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        
        <!-- Header & Title -->
        <header class="mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-5xl font-extrabold text-[#ff6b6b] flex items-center">
                <span class="text-5xl sm:text-6xl mr-3" style="text-shadow: 0 0 15px #ff6b6b;">ðŸ”¥</span>
                Flame
                <span class="ml-2 text-base sm:text-xl text-gray-400 font-medium hidden sm:inline-block">Assistant Control Panel</span>
            </h1>
            <p class="text-gray-400 mt-1 text-sm sm:text-base">Real-time monitoring and interaction with the ESP32 voice assistant.</p>
        </header>

        <!-- Main Grid Layout (Responsive: Stacked on mobile, two columns on desktop) -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Panel: Status, ID, Controls, and Scores (Stays on left on desktop) -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Application ID Card (NEW - uses the ID you provided) -->
                <div class="bg-[#2a2a47] p-5 rounded-xl shadow-2xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-3 text-cyan-400 flex items-center">
                        <i data-lucide="server" class="w-5 h-5 mr-2"></i>
                        Application ID
                    </h2>
                    <div class="flex items-center justify-between space-x-2">
                        <div id="app-id" class="text-xs sm:text-sm font-mono bg-[#313154] p-3 rounded-lg overflow-x-auto whitespace-nowrap text-cyan-300 flex-grow">
                            588ad7e0-001d-492c-84d4-edf98cd30b45.firebaseio.com
                        </div>
                        <button onclick="copyElementId('app-id')" 
                                class="copy-btn p-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition duration-150 shadow-md flex-shrink-0"
                                title="Copy Application ID">
                            <i data-lucide="copy" class="w-5 h-5 text-white"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">The unique identifier for the entire Flame project.</p>
                </div>


                <!-- Device ID Card (Specific to this running instance) -->
                <div class="bg-[#2a2a47] p-5 rounded-xl shadow-2xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-3 text-[#ff8a00] flex items-center">
                        <i data-lucide="scan" class="w-5 h-5 mr-2"></i>
                        Device ID
                    </h2>
                    <div class="flex items-center justify-between space-x-2">
                        <!-- ID Display - Use a monospace font for clarity -->
                        <div id="connection-id" class="text-sm sm:text-base font-mono bg-[#313154] p-3 rounded-lg overflow-x-auto whitespace-nowrap text-cyan-300 flex-grow">
                            <!-- ID will be inserted here by JavaScript -->
                        </div>
                        <!-- Copy Button -->
                        <button onclick="copyElementId('connection-id')" 
                                class="copy-btn p-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition duration-150 shadow-md flex-shrink-0"
                                title="Copy Device ID to clipboard">
                            <i data-lucide="copy" class="w-5 h-5 text-white"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Unique ID for this specific physical device.</p>
                </div>


                <!-- Current Status Card -->
                <div class="bg-[#2a2a47] p-5 rounded-xl shadow-2xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-3 text-[#ff8a00]">Device Status</h2>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between border-b border-[#313154] pb-2">
                            <span class="flex items-center text-sm sm:text-base">
                                <i data-lucide="cpu" class="w-4 h-4 sm:w-5 sm:h-5 mr-3 text-cyan-400"></i>
                                Operating State
                            </span>
                            <div id="state-indicator" class="flex items-center font-semibold text-sm sm:text-base">
                                <span id="status-dot" class="status-dot w-3 h-3 rounded-full mr-2 bg-gray-500"></span>
                                <span id="status-text">IDLE</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between border-b border-[#313154] py-2">
                            <span class="flex items-center text-sm sm:text-base">
                                <i data-lucide="zap" class="w-4 h-4 sm:w-5 sm:h-5 mr-3 text-green-400"></i>
                                Power/Heat
                            </span>
                            <span id="temp-display" class="text-sm sm:text-base">35.0Â°C (Normal)</span>
                        </div>
                        <div class="flex items-center justify-between pt-2">
                            <span class="flex items-center text-sm sm:text-base">
                                <i data-lucide="wifi" class="w-4 h-4 sm:w-5 sm:h-5 mr-3 text-purple-400"></i>
                                Network
                            </span>
                            <span id="wifi-status" class="text-green-500 font-medium text-sm sm:text-base">CONNECTED</span>
                        </div>
                    </div>
                </div>

                <!-- Gaming & Scoring Card (ELO) -->
                <div class="bg-[#2a2a47] p-5 rounded-xl shadow-2xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-3 text-[#ff8a00]">Challenge Data</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-[#313154] p-3 rounded-lg">
                            <span class="flex items-center font-medium text-sm sm:text-base">
                                <i data-lucide="gem" class="w-5 h-5 mr-3 text-yellow-500"></i>
                                ELO Rating
                            </span>
                            <span id="elo-rating" class="text-xl sm:text-2xl font-bold text-yellow-300">1000</span>
                        </div>
                        <div class="flex justify-between items-center bg-[#313154] p-3 rounded-lg">
                            <span class="flex items-center font-medium text-sm sm:text-base">
                                <i data-lucide="clock" class="w-5 h-5 mr-3 text-indigo-400"></i>
                                Survival Days
                            </span>
                            <span id="survival-days" class="text-xl sm:text-2xl font-bold">0</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="bg-[#2a2a47] p-5 rounded-xl shadow-2xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-3 text-[#ff8a00]">Quick Actions</h2>
                    <div class="grid grid-cols-2 gap-3 sm:gap-4">
                        <button onclick="sendCommand('START_LISTENING')" class="flex items-center justify-center p-3 text-sm rounded-lg font-semibold bg-green-600 hover:bg-green-700 transition duration-150 shadow-md">
                            <i data-lucide="mic" class="w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"></i> Listen
                        </button>
                        <button onclick="sendCommand('TRIGGER_MACRO')" class="flex items-center justify-center p-3 text-sm rounded-lg font-semibold bg-orange-600 hover:bg-orange-700 transition duration-150 shadow-md">
                            <i data-lucide="sword" class="w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"></i> Macro
                        </button>
                        <button onclick="sendCommand('ENTER_COOLDOWN')" class="flex items-center justify-center p-3 text-sm rounded-lg font-semibold bg-gray-500 hover:bg-gray-600 transition duration-150 shadow-md">
                            <i data-lucide="thermometer" class="w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"></i> Cooldown
                        </button>
                        <button onclick="sendCommand('RESET')" class="flex items-center justify-center p-3 text-sm rounded-lg font-semibold bg-red-600 hover:bg-red-700 transition duration-150 shadow-md">
                            <i data-lucide="rotate-ccw" class="w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"></i> Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Chat Interface (Takes up 2/3 width on desktop) -->
            <div class="lg:col-span-2 bg-[#2a2a47] p-5 rounded-xl shadow-2xl flex flex-col h-[500px] sm:h-[650px] lg:h-[800px]">
                <h2 class="text-xl font-bold mb-4 text-[#ff8a00] border-b border-[#313154] pb-2">Conversational Log</h2>
                
                <!-- Chat History -->
                <div id="chat-history" class="flex-grow overflow-y-auto space-y-4 p-2 mb-4 bg-[#313154] rounded-lg">
                    <!-- Initial Welcome Message -->
                    <div class="flex justify-start">
                        <div class="bg-[#ff6b6b] text-white p-3 rounded-b-xl rounded-tr-xl max-w-[85%] sm:max-w-md shadow-md">
                            <p class="font-bold">Flame</p>
                            <p class="text-sm">System initialized and online. Application ID confirmed: 588ad7e0...firebaseio.com.</p>
                        </div>
                    </div>
                    <!-- Placeholder User Message -->
                    <div class="flex justify-end">
                        <div class="bg-blue-600 text-white p-3 rounded-b-xl rounded-tl-xl max-w-[85%] sm:max-w-md shadow-md">
                            <p class="font-bold">User</p>
                            <p class="text-sm">Flame, start listening for a command.</p>
                        </div>
                    </div>
                    <!-- Placeholder Flame Response -->
                    <div class="flex justify-start">
                        <div class="bg-[#ff6b6b] text-white p-3 rounded-b-xl rounded-tr-xl max-w-[85%] sm:max-w-md shadow-md">
                            <p class="font-bold">Flame</p>
                            <p class="text-sm">Entering LISTENING mode. Awaiting voice input.</p>
                        </div>
                    </div>
                </div>

                <!-- Input Area (Mockup) -->
                <div class="flex space-x-3">
                    <input type="text" id="user-input" placeholder="Type a command or message..."
                           class="flex-grow p-3 rounded-lg bg-[#1a1a2e] border border-[#ff6b6b] focus:ring-2 focus:ring-[#ff8a00] outline-none text-gray-200 text-sm">
                    <button onclick="sendMessage()"
                            class="p-3 bg-[#ff6b6b] hover:bg-[#ff8a00] rounded-lg font-bold transition duration-150 shadow-md flex items-center">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <script>
        const states = {
            IDLE: { dot: 'bg-gray-500', text: 'IDLE' },
            LISTENING: { dot: 'bg-yellow-500', text: 'LISTENING' },
            SPEAKING: { dot: 'bg-purple-500', text: 'SPEAKING' },
            GAMING_MODE: { dot: 'bg-lime-500', text: 'GAMING_MODE' },
            MINECRAFT_MACRO_MODE: { dot: 'bg-orange-500', text: 'MACRO ACTIVE' },
            COOLDOWN: { dot: 'bg-blue-500', text: 'COOLDOWN' },
            ERROR_STATE: { dot: 'bg-red-500', text: 'ERROR_STATE' },
            OVERHEAT: { dot: 'bg-red-700', text: 'OVERHEAT' },
        };

        let currentState = 'IDLE';

        // Function to update the displayed status
        function updateStatus(newState) {
            currentState = newState;
            const stateData = states[newState] || states['IDLE'];

            document.getElementById('status-text').textContent = stateData.text;

            const dot = document.getElementById('status-dot');
            Object.values(states).forEach(s => {
                dot.classList.remove(s.dot);
            });
            dot.classList.add(stateData.dot);

            // Mock temperature update
            let temp = 35.0 + Math.random() * 5;
            let tempColor = 'text-green-500';
            let tempText = 'Normal';

            if (newState === 'OVERHEAT' || newState === 'COOLDOWN') {
                temp = newState === 'OVERHEAT' ? 51.5 : 45.0 + Math.random() * 5;
                tempColor = newState === 'OVERHEAT' ? 'text-red-500' : 'text-yellow-500';
                tempText = newState === 'OVERHEAT' ? 'CRITICAL' : 'Cooling Down';
            }
            
            const tempDisplay = document.getElementById('temp-display');
            tempDisplay.textContent = `${temp.toFixed(1)}Â°C (${tempText})`;
            tempDisplay.className = tempColor;

            addMessage('SYSTEM', `State changed to: ${newState}`);
        }

        // Function to simulate sending commands and handling state changes
        function sendCommand(command) {
            console.log(`Command sent: ${command}`);
            
            switch(command) {
                case 'START_LISTENING':
                    updateStatus('LISTENING');
                    break;
                case 'TRIGGER_MACRO':
                    updateStatus('MINECRAFT_MACRO_MODE');
                    setTimeout(() => updateStatus('IDLE'), 3000); 
                    break;
                case 'ENTER_COOLDOWN':
                    updateStatus('COOLDOWN');
                    setTimeout(() => updateStatus('IDLE'), 5000); 
                    break;
                case 'RESET':
                    updateStatus('IDLE');
                    document.getElementById('elo-rating').textContent = '1000';
                    document.getElementById('survival-days').textContent = '0';
                    break;
            }
        }
        
        // Function to add a message to the chat history
        function addMessage(sender, text) {
            const chatHistory = document.getElementById('chat-history');
            const isUser = sender === 'User';
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const bubble = document.createElement('div');
            // Dynamically calculate max width to be responsive
            bubble.className = `p-3 rounded-b-xl shadow-md text-white text-sm max-w-[85%] sm:max-w-md ${isUser ? 'bg-blue-600 rounded-tl-xl' : 'bg-[#ff6b6b] rounded-tr-xl'}`;
            
            const senderSpan = document.createElement('p');
            senderSpan.className = 'font-bold';
            senderSpan.textContent = sender;

            const textP = document.createElement('p');
            textP.textContent = text;
            
            bubble.appendChild(senderSpan);
            bubble.appendChild(textP);
            messageDiv.appendChild(bubble);
            chatHistory.appendChild(messageDiv);
            
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Function to send user input message
        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();

            if (message) {
                addMessage('User', message);
                input.value = '';
                
                // Mock Flame response
                setTimeout(() => {
                    const response = `Acknowledged: "${message}". The device is currently in the ${currentState} state.`;
                    addMessage('Flame', response);
                }, 1000);
            }
        }
        
        // Function to copy the connection ID to clipboard
        function copyElementId(elementId) {
            const idElement = document.getElementById(elementId);
            const idText = idElement.textContent;
            
            // Find the corresponding copy button by traversing the DOM
            const button = idElement.nextElementSibling;

            // Use the preferred clipboard API, with execCommand as a fallback
            if (navigator.clipboard) {
                navigator.clipboard.writeText(idText).then(() => {
                    showCopiedFeedback(button);
                }).catch(err => {
                    console.error('Could not copy text using clipboard API: ', err);
                    fallbackCopy(idText, button);
                });
            } else {
                fallbackCopy(idText, button);
            }
        }

        function fallbackCopy(text, button) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showCopiedFeedback(button);
            } catch (err) {
                console.error('Fallback copy failed: ', err);
            }
            document.body.removeChild(textarea);
        }

        function showCopiedFeedback(button) {
            // Store original content
            const originalIcon = button.innerHTML;
            
            button.classList.add('copied');
            button.innerHTML = '<i data-lucide="check" class="w-5 h-5 text-white"></i>';
            lucide.createIcons();
            
            setTimeout(() => {
                button.classList.remove('copied');
                button.innerHTML = originalIcon;
                lucide.createIcons();
            }, 1500);
        }

        // Initialize the status indicator, ID, and icons when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); 
            
            // Mock the Device ID (a short, user-friendly UUID for the specific assistant device)
            const mockDeviceId = 'FLAME-32E7-ESP';
            document.getElementById('connection-id').textContent = mockDeviceId;

            updateStatus(currentState); 
            
            // Make Enter key trigger sendMessage
            document.getElementById('user-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); 
                    sendMessage();
                }
            });
        });
        
    </script>

</body>
</html>